<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Portal - JOH Technologies</title>
  <meta name="robots" content="noindex, nofollow">
  
  <link rel="icon" href="favicon.ico">
  <link rel="stylesheet" href="css/style.css">
  
  <!-- Cloudinary Upload Widget -->
  <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
</head>
<body>
  <div class="admin-container">
    <!-- Admin Header -->
    <header class="admin-header">
      <div class="container">
        <div class="admin-header-inner">
          <a href="index.html" class="navbar-brand">
            <div class="navbar-logo">JT</div>
            <span class="navbar-title">JOH <span>Technologies</span></span>
          </a>
          <button onclick="logout()" class="btn btn-outline" style="display: none;" id="logout-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
              <polyline points="16 17 21 12 16 7"></polyline>
              <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            Logout
          </button>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="admin-main">
      <div class="container">
        <!-- Login Section -->
        <section id="admin-login" class="admin-login">
          <div class="admin-card">
            <div style="text-align: center; margin-bottom: 1.5rem;">
              <div class="navbar-logo" style="width: 64px; height: 64px; font-size: 1.5rem; margin: 0 auto 1rem;">JT</div>
              <h2>Admin Portal</h2>
              <p>Enter your password to access the dashboard</p>
            </div>
            
            <form id="login-form">
              <div class="form-group">
                <label for="password">Password</label>
                <input 
                  type="password" 
                  id="password" 
                  class="form-input" 
                  placeholder="Enter admin password"
                  required
                  autocomplete="current-password"
                >
                <p id="error-message" class="error-message"></p>
              </div>
              
              <button type="submit" class="btn btn-admin btn-block">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                  <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
                Login
              </button>
            </form>
          </div>
        </section>

        <!-- Dashboard Section -->
        <section id="admin-dashboard" class="admin-dashboard">
          <div class="admin-card" style="max-width: 600px;">
            <h2>Product Upload</h2>
            <p>Add new products to your store using Cloudinary</p>
            
            <div class="upload-section">
              <div class="form-group">
                <label for="upload-name">Product Name</label>
                <input 
                  type="text" 
                  id="upload-name" 
                  class="form-input" 
                  placeholder="Enter product name"
                  required
                >
              </div>
              
              <div class="form-group">
                <label for="upload-category">Category</label>
                <select id="upload-category" class="form-input">
                  <option value="laptops">Laptops</option>
                  <option value="desktops">Desktops</option>
                  <option value="accessories">Accessories</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="upload-price">Price (e.g., UGX 5,000,000)</label>
                <input 
                  type="text" 
                  id="upload-price" 
                  class="form-input" 
                  placeholder="Enter product price"
                  required
                >
              </div>
              
              <div class="form-group">
                <label for="upload-description">Description</label>
                <textarea 
                  id="upload-description" 
                  class="form-input form-textarea" 
                  placeholder="Enter product description (specs, features, etc.)"
                  required
                ></textarea>
              </div>
              
              <div class="form-group">
                <label for="upload-image">Product Image</label>
                <input 
                  type="file" 
                  id="upload-image" 
                  class="form-input" 
                  accept="image/*"
                  required
                >
              </div>
              
              <button id="upload-button" class="btn btn-admin btn-block">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                  <polyline points="17 8 12 3 7 8"></polyline>
                  <line x1="12" y1="3" x2="12" y2="15"></line>
                </svg>
                Upload Product
              </button>
              
              <p id="upload-status" style="margin-top: 1rem; text-align: center;"></p>
            </div>
            
            <div class="admin-instructions">
              <h4>How to Upload Products:</h4>
              <ol>
                <li>Enter the product name</li>
                <li>Select the product category</li>
                <li>Enter the price (include currency)</li>
                <li>Write a detailed description</li>
                <li>Select product image file</li>
                <li>Click "Upload Product" to submit</li>
              </ol>
            </div>
            
            <div class="admin-instructions" style="margin-top: 1rem; background: hsl(210, 100%, 95%);">
              <h4>Cloudinary Setup Required:</h4>
              <ol>
                <li>Open <code>js/config.js</code></li>
                <li>Replace <code>'your-cloud-name'</code> with your Cloudinary cloud name</li>
                <li>Create an unsigned upload preset named <code>'joh-tech'</code> in your Cloudinary settings</li>
                <li>Enable "Resource list" in your Cloudinary Security settings</li>
              </ol>
            </div>
          </div>
        </section>
      </div>
    </main>

    <!-- Footer -->
    <footer class="footer" style="padding: 1.5rem 0;">
      <div class="container">
        <div class="footer-bottom" style="border: none; padding: 0;">
          <p>&copy; 2024 JOH Technologies. Admin Portal.</p>
        </div>
      </div>
    </footer>
  </div>

  <!-- Scripts -->
  <script src="js/config.js"></script>
  <script src="js/admin.js"></script>
  <script>
    // Configuration
    const WORKER_URL = 'https://cloudinary-worker.abahoornest.workers.dev';
    
    document.addEventListener('DOMContentLoaded', function() {
      const uploadBtn = document.getElementById('upload-button');
      if (uploadBtn) {
        uploadBtn.onclick = async () => {
          const file = document.getElementById('upload-image').files[0];
          const name = document.getElementById('upload-name').value;
          const price = document.getElementById('upload-price').value;
          const description = document.getElementById('upload-description').value;
          const category = document.getElementById('upload-category').value;
          const status = document.getElementById('upload-status');
  
          if (!file || !name || !price) {
            status.textContent = "Missing required fields";
            status.style.color = "#e74c3c";
            return;
          }
  
          // Prepare form data
          const formData = new FormData();
          formData.append("file", file);
          formData.append("name", name);
          formData.append("price", price);
          formData.append("description", description);
          formData.append("category", category);
  
          status.textContent = "Uploading via Cloudflare Worker...";
          status.style.color = "#f39c12";
  
          try {
            const response = await fetch(WORKER_URL, {
              method: 'POST',
              body: formData,
            });
  
            const data = await response.json();
  
            if (data.success) {
              status.textContent = "Upload successful! âœ“";
              status.style.color = "#27ae60";
              
              // Clear form
              document.getElementById('upload-image').value = '';
              document.getElementById('upload-name').value = '';
              document.getElementById('upload-price').value = '';
              document.getElementById('upload-description').value = '';
              document.getElementById('upload-category').value = 'laptops';
              
              console.log("Uploaded via Cloudflare Worker:", data);
              
              // Show success message for 3 seconds
              setTimeout(() => {
                status.textContent = "";
              }, 3000);
            } else {
              status.textContent = "Upload failed: " + (data.error || "Unknown error");
              status.style.color = "#e74c3c";
            }
          } catch (err) {
            status.textContent = "Error: " + err.message;
            status.style.color = "#e74c3c";
            console.error("Worker upload error:", err);
          }
        };
      }
    });
  </script>
</body>
</html>